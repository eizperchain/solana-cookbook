<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="title" content="Solana Cookbook | Using Switchboard to create Onchain data feeds"><meta name="og:title" content="Solana Cookbook | Using Switchboard to create Onchain data feeds"><meta name="description" content="Switchboard allows builders to unlock the power of Solana by creating high performance data feeds from any API."><meta name="og:description" content="Switchboard allows builders to unlock the power of Solana by creating high performance data feeds from any API."><meta name="og:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="og:image:alt" content="Solana splash card"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@solanacookbook"><meta name="twitter:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="robots" content="index,follow,noodp"><meta name="googlebot" content="index,follow"><link rel="icon" href="/solana_cookbook_lightmode.svg"><script data-domain="solanacookbook.com" src="https://plausible.io/js/plausible.js"></script><title>Switchboard | Solana Cookbook</title>
    <link rel="modulepreload" href="/assets/app.28f6b3e6.js"><link rel="modulepreload" href="/assets/switchboard.html.48465e15.js"><link rel="modulepreload" href="/assets/switchboard.html.1cb039de.js">
    <link rel="stylesheet" href="/assets/style.fecd2c41.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">Solana Cookbook</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Contribute"><!--[--><!--]--> Contribute <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/integrations" class="router-link-active" aria-label="Integrations"><!--[--><!--]--> Integrations <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/integrations/switchboard.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/" class="" aria-label="中文"><!--[--><!--]--> 中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/integrations/switchboard.html" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/integrations/switchboard.html" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/integrations/switchboard.html" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Contribute"><!--[--><!--]--> Contribute <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/integrations" class="router-link-active" aria-label="Integrations"><!--[--><!--]--> Integrations <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/integrations/switchboard.html" class="router-link-active router-link-exact-active router-link-active" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/" class="" aria-label="中文"><!--[--><!--]--> 中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/integrations/switchboard.html" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/integrations/switchboard.html" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/integrations/switchboard.html" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">Integrations <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/integrations" class="router-link-active sidebar-item" aria-label="Getting Started"><!--[--><!--]--> Getting Started <!--[--><!--]--></a><!----></li><li><a href="/integrations/serum.html" class="sidebar-item" aria-label="Serum"><!--[--><!--]--> Serum <!--[--><!--]--></a><!----></li><li><a href="/integrations/pyth.html" class="sidebar-item" aria-label="Pyth"><!--[--><!--]--> Pyth <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/integrations/switchboard.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Switchboard"><!--[--><!--]--> Switchboard <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/integrations/switchboard.html#data-feeds" class="router-link-active router-link-exact-active sidebar-item" aria-label="Data Feeds"><!--[--><!--]--> Data Feeds <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/integrations/switchboard.html#read-data-from-an-aggregator-feed" class="router-link-active router-link-exact-active sidebar-item" aria-label="Read data from an aggregator feed"><!--[--><!--]--> Read data from an aggregator feed <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/integrations/switchboard.html#create-a-new-aggregator-feed" class="router-link-active router-link-exact-active sidebar-item" aria-label="Create a new aggregator feed"><!--[--><!--]--> Create a new aggregator feed <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/integrations/switchboard.html#read-data-from-an-aggregator-feed-in-program" class="router-link-active router-link-exact-active sidebar-item" aria-label="Read data from an aggregator feed in program"><!--[--><!--]--> Read data from an aggregator feed in program <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/integrations/switchboard.html#how-to-create-a-feed-from-the-publisher" class="router-link-active router-link-exact-active sidebar-item" aria-label="How to Create a Feed from the Publisher"><!--[--><!--]--> How to Create a Feed from the Publisher <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/integrations/switchboard.html#oracles" class="router-link-active router-link-exact-active sidebar-item" aria-label="Oracles"><!--[--><!--]--> Oracles <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/integrations/switchboard.html#create-an-oracle" class="router-link-active router-link-exact-active sidebar-item" aria-label="Create an oracle"><!--[--><!--]--> Create an oracle <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/integrations/switchboard.html#run-an-oracle-locally" class="router-link-active router-link-exact-active sidebar-item" aria-label="Run an oracle locally"><!--[--><!--]--> Run an oracle locally <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/integrations/switchboard.html#oracle-config" class="router-link-active router-link-exact-active sidebar-item" aria-label="Oracle Config"><!--[--><!--]--> Oracle Config <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/integrations/switchboard.html#verifiable-random-function-vrf" class="router-link-active router-link-exact-active sidebar-item" aria-label="Verifiable Random Function(VRF)"><!--[--><!--]--> Verifiable Random Function(VRF) <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/integrations/switchboard.html#reading-a-vrf-account" class="router-link-active router-link-exact-active sidebar-item" aria-label="Reading a VRF account"><!--[--><!--]--> Reading a VRF account <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/integrations/switchboard.html#creating-a-vrf-account" class="router-link-active router-link-exact-active sidebar-item" aria-label="Creating a VRF account"><!--[--><!--]--> Creating a VRF account <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/integrations/switchboard.html#request-randomness-from-vrf-account" class="router-link-active router-link-exact-active sidebar-item" aria-label="Request Randomness from vrf account"><!--[--><!--]--> Request Randomness from vrf account <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/integrations/switchboard.html#resources" class="router-link-active router-link-exact-active sidebar-item" aria-label="Resources"><!--[--><!--]--> Resources <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/integrations/switchboard.html#apis-and-libraries" class="router-link-active router-link-exact-active sidebar-item" aria-label="APIs and Libraries"><!--[--><!--]--> APIs and Libraries <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/integrations/switchboard.html#examples" class="router-link-active router-link-exact-active sidebar-item" aria-label="Examples"><!--[--><!--]--> Examples <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/integrations/switchboard.html#more-information" class="router-link-active router-link-exact-active sidebar-item" aria-label="More Information"><!--[--><!--]--> More Information <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><li><a href="/integrations/mango.html" class="sidebar-item" aria-label="Mango Markets"><!--[--><!--]--> Mango Markets <!--[--><!--]--></a><!----></li><li><a href="/integrations/strata.html" class="sidebar-item" aria-label="Strata"><!--[--><!--]--> Strata <!--[--><!--]--></a><!----></li><li><a href="/integrations/web3auth.html" class="sidebar-item" aria-label="web3Auth (Torus Wallet)"><!--[--><!--]--> web3Auth (Torus Wallet) <!--[--><!--]--></a><!----></li><li><a href="/integrations/react-native.html" class="sidebar-item" aria-label="React Native"><!--[--><!--]--> React Native <!--[--><!--]--></a><!----></li><li><a href="/integrations/jupiter.html" class="sidebar-item" aria-label="Jupiter"><!--[--><!--]--> Jupiter <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="switchboard" tabindex="-1"><a class="header-anchor" href="#switchboard" aria-hidden="true">#</a> Switchboard</h1><p>Switchboard is an Oracle protocol that enables developers to source data on-chain for a variety of use cases such as price feeds, NFT floor prices, sport statistics, or even verifiable randomness. In a general sense, Switchboard is an off-chain resource developers can invoke to bridge high integrity data on-chain and power the next generation of web3 and DeFi.</p><h2 id="data-feeds" tabindex="-1"><a class="header-anchor" href="#data-feeds" aria-hidden="true">#</a> Data Feeds</h2><p>Switchboard provides a JavaScript/TypeScript library called <strong>@switchboard-xyz/switchboard-v2</strong> . This library can be used to reach On-chain data from existing data feeds or publish your own custom feeds. Learn more about this <a href="https://www.npmjs.com/package/@switchboard-xyz/switchboard-v2" target="_blank" rel="noopener noreferrer">here<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="read-data-from-an-aggregator-feed" tabindex="-1"><a class="header-anchor" href="#read-data-from-an-aggregator-feed" aria-hidden="true">#</a> Read data from an aggregator feed</h3><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  clusterApiUrl<span class="token punctuation">,</span>
  Connection<span class="token punctuation">,</span>
  Keypair<span class="token punctuation">,</span>
  PublicKey<span class="token punctuation">,</span>
  <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> switchboard <span class="token keyword">from</span> <span class="token string">&quot;@switchboard-xyz/switchboard-v2&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> payer <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token function">clusterApiUrl</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token keyword">await</span> switchboard<span class="token punctuation">.</span><span class="token function">loadSwitchboardProgram</span><span class="token punctuation">(</span>
    <span class="token string">&quot;devnet&quot;</span><span class="token punctuation">,</span>
    connection<span class="token punctuation">,</span>
    payer
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> airdropSignature <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">requestAirdrop</span><span class="token punctuation">(</span>
    payer<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    <span class="token constant">LAMPORTS_PER_SOL</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>airdropSignature<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;here&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> aggregatorAccount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">switchboard</span><span class="token punctuation">.</span><span class="token function">AggregatorAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    program<span class="token operator">:</span> program<span class="token punctuation">,</span>
    publicKey<span class="token operator">:</span> aggregatorKey<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> result<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token keyword">await</span> aggregatorAccount<span class="token punctuation">.</span><span class="token function">getLatestValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">toNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">let</span> aggregatorKey<span class="token operator">:</span> PublicKey<span class="token punctuation">;</span>
<span class="token keyword">let</span> program<span class="token operator">:</span> Program<span class="token operator">&lt;</span>Idl<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> aggregatorAccount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">switchboard</span><span class="token punctuation">.</span><span class="token function">AggregatorAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  program<span class="token operator">:</span> program<span class="token punctuation">,</span>
  publicKey<span class="token operator">:</span> aggregatorKey<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> result<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token keyword">await</span> aggregatorAccount<span class="token punctuation">.</span><span class="token function">getLatestValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><!--]--></div></div><!--]--></div><h3 id="create-a-new-aggregator-feed" tabindex="-1"><a class="header-anchor" href="#create-a-new-aggregator-feed" aria-hidden="true">#</a> Create a new aggregator feed</h3><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> anchor <span class="token keyword">from</span> <span class="token string">&quot;@project-serum/anchor&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Keypair <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  AggregatorAccount<span class="token punctuation">,</span>
  loadSwitchboardProgram<span class="token punctuation">,</span>
  LeaseAccount<span class="token punctuation">,</span>
  OracleQueueAccount<span class="token punctuation">,</span>
  SwitchboardPermission<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@switchboard-xyz/switchboard-v2&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> payer<span class="token operator">:</span> Keypair<span class="token punctuation">;</span>
<span class="token keyword">let</span> authority<span class="token operator">:</span> Keypair<span class="token punctuation">;</span> <span class="token comment">// queue authority</span>
<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">loadSwitchboardProgram</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> payer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> queueAccount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OracleQueueAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  program<span class="token punctuation">,</span>
  publicKey<span class="token operator">:</span> queuePubkey<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// aggregator</span>
<span class="token keyword">const</span> aggregatorAccount <span class="token operator">=</span> <span class="token keyword">await</span> AggregatorAccount<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;MY SOL/USD Feed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  batchSize<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  minRequiredOracleResults<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  minRequiredJobResults<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  minUpdateDelaySeconds<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  queueAccount<span class="token punctuation">,</span>
  authority<span class="token operator">:</span> authority<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// permission</span>
<span class="token keyword">const</span> permissionAccount <span class="token operator">=</span> <span class="token keyword">await</span> PermissionAccount<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  authority<span class="token operator">:</span> authority<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
  granter<span class="token operator">:</span> queueAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
  grantee<span class="token operator">:</span> aggregatorAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> aggregatorPermission<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  authority<span class="token punctuation">,</span>
  permission<span class="token operator">:</span> SwitchboardPermission<span class="token punctuation">.</span><span class="token constant">PERMIT_ORACLE_QUEUE_USAGE</span><span class="token punctuation">,</span>
  enable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// lease</span>
<span class="token keyword">const</span> leaseContract <span class="token operator">=</span> <span class="token keyword">await</span> LeaseAccount<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  loadAmount<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">anchor</span><span class="token punctuation">.</span><span class="token constant">BN</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  funder<span class="token operator">:</span> tokenAccount<span class="token punctuation">,</span>
  funderAuthority<span class="token operator">:</span> authority<span class="token punctuation">,</span>
  oracleQueueAccount<span class="token operator">:</span> queueAccount<span class="token punctuation">,</span>
  aggregatorAccount<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// job</span>
<span class="token keyword">const</span> tasks<span class="token operator">:</span> OracleJob<span class="token punctuation">.</span>Task<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  OracleJob<span class="token punctuation">.</span>Task<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    httpTask<span class="token operator">:</span> OracleJob<span class="token punctuation">.</span>HttpTask<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://ftx.us/api/markets/SOL_USD</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  OracleJob<span class="token punctuation">.</span>Task<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    jsonParseTask<span class="token operator">:</span> OracleJob<span class="token punctuation">.</span>JsonParseTask<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token string">&quot;$.result.price&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> jobData <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>
  OracleJob<span class="token punctuation">.</span><span class="token function">encodeDelimited</span><span class="token punctuation">(</span>
    OracleJob<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      tasks<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> jobKeypair <span class="token operator">=</span> anchor<span class="token punctuation">.</span>web3<span class="token punctuation">.</span>Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> jobAccount <span class="token operator">=</span> <span class="token keyword">await</span> JobAccount<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  data<span class="token operator">:</span> jobData<span class="token punctuation">,</span>
  keypair<span class="token operator">:</span> jobKeypair<span class="token punctuation">,</span>
  authority<span class="token operator">:</span> authority<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// add job to aggregator</span>
<span class="token keyword">await</span> aggregatorAccount<span class="token punctuation">.</span><span class="token function">addJob</span><span class="token punctuation">(</span>jobAccount<span class="token punctuation">,</span> authority<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> queueAccount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OracleQueueAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  program<span class="token punctuation">,</span>
  publicKey<span class="token operator">:</span> queuePubkey<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> aggregatorAccount <span class="token operator">=</span> <span class="token keyword">await</span> AggregatorAccount<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;MY SOL/USD Feed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  batchSize<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  minRequiredOracleResults<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  minRequiredJobResults<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  minUpdateDelaySeconds<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  queueAccount<span class="token punctuation">,</span>
  authority<span class="token operator">:</span> authority<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aggregatorAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><!--]--></div></div><!--]--></div><h3 id="read-data-from-an-aggregator-feed-in-program" tabindex="-1"><a class="header-anchor" href="#read-data-from-an-aggregator-feed-in-program" aria-hidden="true">#</a> Read data from an aggregator feed in program</h3><p>Switchboard provides a crate called <strong>switchboard_v2</strong> Learn more about this <a href="https://docs.rs/switchboard-v2/0.1.10/switchboard_v2/" target="_blank" rel="noopener noreferrer">here<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Rust</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token namespace">switchboard_v2<span class="token punctuation">::</span></span><span class="token class-name">AggregatorAccountData</span><span class="token punctuation">;</span>

<span class="token macro property">declare_id!</span><span class="token punctuation">(</span><span class="token string">&quot;HDa6A4wLjEymb8Cv3UGeGBnFUNCUEMpoiVBbkTKAkfrt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[program]</span>
<span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">get_result</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>
   
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">get_result</span><span class="token punctuation">(</span>ctx<span class="token punctuation">:</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token class-name">GetResult</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> aggregator <span class="token operator">=</span> <span class="token operator">&amp;</span>ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>aggregator_feed<span class="token punctuation">;</span>
        <span class="token keyword">let</span> val<span class="token punctuation">:</span> <span class="token keyword">f64</span> <span class="token operator">=</span> <span class="token class-name">AggregatorAccountData</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>aggregator<span class="token punctuation">)</span><span class="token operator">?</span>
            <span class="token punctuation">.</span><span class="token function">get_result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span>
            <span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;Current feed result is {}!&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
   
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[derive(Accounts)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">GetResult</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> authority<span class="token punctuation">:</span> <span class="token class-name">Signer</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token comment">/// CHECK: field is unsafe</span>
    <span class="token keyword">pub</span> aggregator_feed<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token comment">// pass aggregator key</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> aggregator <span class="token operator">=</span> <span class="token operator">&amp;</span>ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>aggregator_feed<span class="token punctuation">;</span>
<span class="token keyword">let</span> val<span class="token punctuation">:</span> <span class="token keyword">f64</span> <span class="token operator">=</span> <span class="token class-name">AggregatorAccountData</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>aggregator<span class="token punctuation">)</span><span class="token operator">?</span>
            <span class="token punctuation">.</span><span class="token function">get_result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span>
            <span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><!--]--></div></div><!--]--></div><h3 id="how-to-create-a-feed-from-the-publisher" tabindex="-1"><a class="header-anchor" href="#how-to-create-a-feed-from-the-publisher" aria-hidden="true">#</a> How to Create a Feed from the Publisher</h3><p>The official Switchboard documentation has an in-depth walk-through of how to create a feed from the publisher. Check it out <a href="https://docs.switchboard.xyz/feed/publisher" target="_blank" rel="noopener noreferrer">here<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><h2 id="oracles" tabindex="-1"><a class="header-anchor" href="#oracles" aria-hidden="true">#</a> Oracles</h2><p>Switchboard&#39;s unique feature is that it allows you to create your own oracle and run it locally.</p><h3 id="create-an-oracle" tabindex="-1"><a class="header-anchor" href="#create-an-oracle" aria-hidden="true">#</a> Create an oracle</h3><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> anchor <span class="token keyword">from</span> <span class="token string">&quot;@project-serum/anchor&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Keypair <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  loadSwitchboardProgram<span class="token punctuation">,</span>
  OracleAccount<span class="token punctuation">,</span>
  OracleQueueAccount<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@switchboard-xyz/switchboard-v2&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> payer<span class="token operator">:</span> Keypair<span class="token punctuation">;</span>
<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">loadSwitchboardProgram</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> payer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> queueAccount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OracleQueueAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  program<span class="token punctuation">,</span>
  publicKey<span class="token operator">:</span> queuePubkey<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create oracle</span>
<span class="token keyword">const</span> oracleAccount <span class="token operator">=</span> <span class="token keyword">await</span> OracleAccount<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;My Oracle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  queueAccount<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> queueAccount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OracleQueueAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  program<span class="token punctuation">,</span>
  publicKey<span class="token operator">:</span> queuePubkey<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create oracle</span>
<span class="token keyword">const</span> oracleAccount <span class="token operator">=</span> <span class="token keyword">await</span> OracleAccount<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;My Oracle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  queueAccount<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><!--]--></div></div><!--]--></div><h3 id="run-an-oracle-locally" tabindex="-1"><a class="header-anchor" href="#run-an-oracle-locally" aria-hidden="true">#</a> Run an oracle locally</h3><p>You can run an oracle locally and assign it to your own oracle queue to test how your program may operate in production. Mainnet oracles should always be run in high availability environments with some set of monitoring capabilities.</p><h4 id="requirements" tabindex="-1"><a class="header-anchor" href="#requirements" aria-hidden="true">#</a> Requirements</h4><ul><li>Docker-compose</li></ul><p>Create a docker-compose.yml file with the environment variables in <a aria-current="page" href="/integrations/switchboard.html#oracle-config" class="router-link-active router-link-exact-active">Oracle Config</a></p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.3&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">switchboard</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&quot;switchboardlabs/node:dev-v2-5-28-22a&quot;</span>
    <span class="token key atrule">network_mode</span><span class="token punctuation">:</span> host
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> LIVE=1
      <span class="token punctuation">-</span> CLUSTER=devnet
      <span class="token punctuation">-</span> RPC_URL=$<span class="token punctuation">{</span>RPC_URL<span class="token punctuation">}</span>
      <span class="token punctuation">-</span> ORACLE_KEY=$<span class="token punctuation">{</span>ORACLE_KEY<span class="token punctuation">}</span>
      <span class="token punctuation">-</span> HEARTBEAT_INTERVAL=15
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./configs.json<span class="token punctuation">:</span>/configs.json
<span class="token key atrule">secrets</span><span class="token punctuation">:</span>
  <span class="token key atrule">PAYER_SECRETS</span><span class="token punctuation">:</span>
    <span class="token key atrule">file</span><span class="token punctuation">:</span> /filesystem/path/to/keypair.json
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.3&quot;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">switchboard</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&quot;switchboardlabs/node:dev-v2-5-28-22a&quot;</span>
    <span class="token key atrule">network_mode</span><span class="token punctuation">:</span> host
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> LIVE=1
      <span class="token punctuation">-</span> CLUSTER=devnet
      <span class="token punctuation">-</span> RPC_URL=$<span class="token punctuation">{</span>RPC_URL<span class="token punctuation">}</span>
      <span class="token punctuation">-</span> ORACLE_KEY=$<span class="token punctuation">{</span>ORACLE_KEY<span class="token punctuation">}</span>
      <span class="token punctuation">-</span> HEARTBEAT_INTERVAL=15
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./configs.json<span class="token punctuation">:</span>/configs.json
<span class="token key atrule">secrets</span><span class="token punctuation">:</span>
  <span class="token key atrule">PAYER_SECRETS</span><span class="token punctuation">:</span>
    <span class="token key atrule">file</span><span class="token punctuation">:</span> /filesystem/path/to/keypair.json
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><!--]--></div></div><!--]--></div><p>Run the container using <code>docker-compose up</code></p><h3 id="oracle-config" tabindex="-1"><a class="header-anchor" href="#oracle-config" aria-hidden="true">#</a> Oracle Config</h3><table><thead><tr><th>Env Variable</th><th>Definition</th></tr></thead><tbody><tr><td>ORACLE_KEY</td><td><b><u>Required</u></b><br><b>Type</b> - Public Key <br><b>Description</b> - Public key of the oracle account that has been granted permissions to use an oracle queue <br></td></tr><tr><td>HEARTBEAT_INTERVAL</td><td><b><u>Optional</u></b><br><b>Type</b> - Number (seconds) <br><b>Default</b> - 30 <br><b>Description</b> - Seconds between oracle heartbeats. Queues have different oracle heartbeat requirements. Recommended value is 15 </td></tr><tr><td>GCP_CONFIG_BUCKET</td><td><b><u>Optional</u></b><br><b>Type</b> - GCP Resource Path <br><b>Default</b> - Looks for configs.json in the current working directory. If not found, no config is loaded. <br><b>Description</b> - Contains API keys for private API endpoints </td></tr><tr><td>UNWRAP_STAKE_THRESHOLD</td><td><b><u>Optional</u></b><br><b>Type</b> - Number (SOL amount, Ex. 1.55) <br><b>Default</b> - 0, disabled. <br><b>Description</b> - The Solana balance amount to trigger an unwrap stake action. When an oracle&#39;s Solana balance falls below the set threshold, the node will automatically unwrap funds from the oracle&#39;s staking wallet, leaving at least 0.1 wSOL or 10% more than the queue&#39;s minimum stake requirement. </td></tr></tbody></table><h2 id="verifiable-random-function-vrf" tabindex="-1"><a class="header-anchor" href="#verifiable-random-function-vrf" aria-hidden="true">#</a> Verifiable Random Function(VRF)</h2><p>A Verifiable Random Function (VRF) is a public-key pseudorandom function that provides proofs that its outputs were calculated correctly</p><h3 id="reading-a-vrf-account" tabindex="-1"><a class="header-anchor" href="#reading-a-vrf-account" aria-hidden="true">#</a> Reading a VRF account</h3><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Rust</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> anchor <span class="token keyword">from</span> <span class="token string">&quot;@project-serum/anchor&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Keypair <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  loadSwitchboardProgram<span class="token punctuation">,</span>
  VrfAccount<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@switchboard-xyz/switchboard-v2&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> payer<span class="token operator">:</span> Keypair<span class="token punctuation">;</span>
<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">loadSwitchboardProgram</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> payer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> vrfAccount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VrfAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  program<span class="token punctuation">,</span>
  publicKey<span class="token operator">:</span> vrfKey<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> vrf <span class="token operator">=</span> <span class="token keyword">await</span> vrfAccount<span class="token punctuation">.</span><span class="token function">loadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vrf<span class="token punctuation">.</span>currentRound<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> vrfAccount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VrfAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  program<span class="token punctuation">,</span>
  publicKey<span class="token operator">:</span> vrfKey<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> vrf <span class="token operator">=</span> <span class="token keyword">await</span> vrfAccount<span class="token punctuation">.</span><span class="token function">loadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vrf<span class="token punctuation">.</span>currentRound<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><!--]--></div></div><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">switchboard_v2<span class="token punctuation">::</span></span><span class="token class-name">VrfAccountData</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> vrf <span class="token operator">=</span> <span class="token class-name">VrfAccountData</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>vrf_account_info<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> result_buffer <span class="token operator">=</span> vrf<span class="token punctuation">.</span><span class="token function">get_result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> result_buffer <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token number">0u8</span><span class="token punctuation">;</span> <span class="token number">32</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;vrf buffer empty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> value<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token namespace">bytemuck<span class="token punctuation">::</span></span><span class="token function">cast_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result_buffer<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">256000</span> <span class="token keyword">as</span> <span class="token keyword">u128</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> vrf <span class="token operator">=</span> <span class="token class-name">VrfAccountData</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>vrf_account_info<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> result_buffer <span class="token operator">=</span> vrf<span class="token punctuation">.</span><span class="token function">get_result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><!--]--></div></div><!--]--></div><h3 id="creating-a-vrf-account" tabindex="-1"><a class="header-anchor" href="#creating-a-vrf-account" aria-hidden="true">#</a> Creating a VRF account</h3><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> anchor <span class="token keyword">from</span> <span class="token string">&quot;@project-serum/anchor&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Keypair <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  loadSwitchboardProgram<span class="token punctuation">,</span>
  OracleQueueAccount<span class="token punctuation">,</span>
  PermissionAccount<span class="token punctuation">,</span>
  SwitchboardPermission<span class="token punctuation">,</span>
  VrfAccount<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@switchboard-xyz/switchboard-v2&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> payer<span class="token operator">:</span> Keypair<span class="token punctuation">;</span>
<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">loadSwitchboardProgram</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> payer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> queueAccount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">queueAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span> program<span class="token punctuation">,</span> publicKey<span class="token operator">:</span> queueKey <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> queue <span class="token operator">=</span> <span class="token keyword">await</span> queueAccount<span class="token punctuation">.</span><span class="token function">loadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// load client program used for callback</span>
<span class="token keyword">const</span> vrfClientProgram <span class="token operator">=</span> anchor<span class="token punctuation">.</span>workspace
  <span class="token punctuation">.</span>AnchorVrfParser <span class="token keyword">as</span> anchor<span class="token punctuation">.</span>Program<span class="token operator">&lt;</span>AnchorVrfParser<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> vrfSecret <span class="token operator">=</span> anchor<span class="token punctuation">.</span>web3<span class="token punctuation">.</span>Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> vrfIxCoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">anchor</span><span class="token punctuation">.</span><span class="token function">BorshInstructionCoder</span><span class="token punctuation">(</span>vrfClientProgram<span class="token punctuation">.</span>idl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> vrfClientCallback<span class="token operator">:</span> Callback <span class="token operator">=</span> <span class="token punctuation">{</span>
  programId<span class="token operator">:</span> vrfClientProgram<span class="token punctuation">.</span>programId<span class="token punctuation">,</span>
  accounts<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ensure all accounts in updateResult are populated</span>
    <span class="token punctuation">{</span> pubkey<span class="token operator">:</span> vrfClientKey<span class="token punctuation">,</span> isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> isWritable<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> pubkey<span class="token operator">:</span> vrfSecret<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> isSigner<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> isWritable<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  ixData<span class="token operator">:</span> vrfIxCoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;updateResult&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// pass any params for instruction here</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// create VRF</span>
<span class="token keyword">const</span> vrfAccount <span class="token operator">=</span> <span class="token keyword">await</span> VrfAccount<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  queue<span class="token operator">:</span> queueAccount<span class="token punctuation">,</span>
  callback<span class="token operator">:</span> vrfClientCallback<span class="token punctuation">,</span>
  authority<span class="token operator">:</span> vrfClientKey<span class="token punctuation">,</span> <span class="token comment">// vrf authority</span>
  keypair<span class="token operator">:</span> vrfSecret<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// create permission</span>
<span class="token keyword">const</span> permissionAccount <span class="token operator">=</span> <span class="token keyword">await</span> PermissionAccount<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  authority<span class="token operator">:</span> queue<span class="token punctuation">.</span>authority<span class="token punctuation">,</span>
  granter<span class="token operator">:</span> queue<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
  grantee<span class="token operator">:</span> vrfAccount<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// if queue has not enabled unpermissionedVrfEnabled, queue will need to grant permission</span>
<span class="token keyword">let</span> queueAuthority<span class="token operator">:</span> Keypair<span class="token punctuation">;</span>
<span class="token keyword">await</span> permissionAccount<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  authority<span class="token operator">:</span> queueAuthority<span class="token punctuation">,</span>
  permission<span class="token operator">:</span> SwitchboardPermission<span class="token punctuation">.</span><span class="token constant">PERMIT_VRF_REQUESTS</span><span class="token punctuation">,</span>
  enable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> vrfAccount <span class="token operator">=</span> <span class="token keyword">await</span> VrfAccount<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  queue<span class="token operator">:</span> queueAccount<span class="token punctuation">,</span>
  callback<span class="token operator">:</span> vrfClientCallback<span class="token punctuation">,</span>
  authority<span class="token operator">:</span> vrfClientKey<span class="token punctuation">,</span> <span class="token comment">// vrf authority</span>
  keypair<span class="token operator">:</span> vrfSecret<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><!--]--></div></div><!--]--></div><h3 id="request-randomness-from-vrf-account" tabindex="-1"><a class="header-anchor" href="#request-randomness-from-vrf-account" aria-hidden="true">#</a> Request Randomness from vrf account</h3><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Rust</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> anchor <span class="token keyword">from</span> <span class="token string">&quot;@project-serum/anchor&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Keypair <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  loadSwitchboardProgram<span class="token punctuation">,</span>
  VrfAccount<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@switchboard-xyz/switchboard-v2&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> payer<span class="token operator">:</span> Keypair<span class="token punctuation">;</span>
<span class="token keyword">let</span> authority<span class="token operator">:</span> Keypair<span class="token punctuation">;</span>
<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">loadSwitchboardProgram</span><span class="token punctuation">(</span><span class="token string">&quot;devnet&quot;</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> payer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> vrfAccount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VrfAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  program<span class="token punctuation">,</span>
  publicKey<span class="token operator">:</span> vrfKey<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> vrf <span class="token operator">=</span> <span class="token keyword">await</span> vrfAccount<span class="token punctuation">.</span><span class="token function">loadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> queueAccount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OracleQueueAccount</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  program<span class="token punctuation">,</span>
  publicKey<span class="token operator">:</span> vrf<span class="token punctuation">.</span>queuePubkey<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> queue <span class="token operator">=</span> <span class="token keyword">await</span> queueAccount<span class="token punctuation">.</span><span class="token function">loadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mint <span class="token operator">=</span> <span class="token keyword">await</span> queueAccount<span class="token punctuation">.</span><span class="token function">loadMint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> payerTokenWallet <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token keyword">await</span> mint<span class="token punctuation">.</span><span class="token function">getOrCreateAssociatedAccountInfo</span><span class="token punctuation">(</span>payer<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span>address<span class="token punctuation">;</span>

<span class="token keyword">const</span> signature <span class="token operator">=</span> <span class="token keyword">await</span> vrfAccount<span class="token punctuation">.</span><span class="token function">requestRandomness</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  authority<span class="token punctuation">,</span>
  payer<span class="token operator">:</span> payerTokenWallet<span class="token punctuation">,</span>
  payerAuthority<span class="token operator">:</span> payer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">const</span> signature <span class="token operator">=</span> <span class="token keyword">await</span> vrfAccount<span class="token punctuation">.</span><span class="token function">requestRandomness</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  authority<span class="token punctuation">,</span>
  payer<span class="token operator">:</span> payerTokenWallet<span class="token punctuation">,</span>
  payerAuthority<span class="token operator">:</span> payer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><!--]--></div></div><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">pub</span> <span class="token keyword">use</span> <span class="token namespace">switchboard_v2<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">VrfAccountData</span><span class="token punctuation">,</span> <span class="token class-name">VrfRequestRandomness</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anchor_spl<span class="token punctuation">::</span>token<span class="token punctuation">::</span></span><span class="token class-name">Token</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anchor_lang<span class="token punctuation">::</span>solana_program<span class="token punctuation">::</span></span>clock<span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Accounts)]</span>
<span class="token attribute attr-name">#[instruction(params: RequestResultParams)]</span> <span class="token comment">// rpc parameters hint</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">RequestResult</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    #<span class="token punctuation">[</span><span class="token function">account</span><span class="token punctuation">(</span>
        <span class="token keyword">mut</span><span class="token punctuation">,</span>
        seeds <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token constant">STATE_SEED</span><span class="token punctuation">,</span>
            vrf<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            authority<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        bump <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>bump<span class="token punctuation">,</span>
        has_one <span class="token operator">=</span> vrf<span class="token punctuation">,</span>
        has_one <span class="token operator">=</span> authority
    <span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">pub</span> state<span class="token punctuation">:</span> <span class="token class-name">AccountLoader</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">VrfClient</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(signer)]</span>
    <span class="token keyword">pub</span> authority<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(constraint = switchboard_program.executable == true)]</span>
    <span class="token keyword">pub</span> switchboard_program<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(mut, constraint = vrf.owner.as_ref() == switchboard_program.key().as_ref())]</span>
    <span class="token keyword">pub</span> vrf<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(mut, constraint = oracle_queue.owner.as_ref() == switchboard_program.key().as_ref())]</span>
    <span class="token keyword">pub</span> oracle_queue<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> queue_authority<span class="token punctuation">:</span> <span class="token class-name">UncheckedAccount</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(constraint = data_buffer.owner.as_ref() == switchboard_program.key().as_ref())]</span>
    <span class="token keyword">pub</span> data_buffer<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(mut, constraint = permission.owner.as_ref() == switchboard_program.key().as_ref())]</span>
    <span class="token keyword">pub</span> permission<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(mut, constraint = escrow.owner == program_state.key())]</span>
    <span class="token keyword">pub</span> escrow<span class="token punctuation">:</span> <span class="token class-name">Account</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">TokenAccount</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(mut, constraint = payer_wallet.owner == payer_authority.key())]</span>
    <span class="token keyword">pub</span> payer_wallet<span class="token punctuation">:</span> <span class="token class-name">Account</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">TokenAccount</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(signer)]</span>
    <span class="token keyword">pub</span> payer_authority<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(address = solana_program::sysvar::recent_blockhashes::ID)]</span>
    <span class="token keyword">pub</span> recent_blockhashes<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(constraint = program_state.owner.as_ref() == switchboard_program.key().as_ref())]</span>
    <span class="token keyword">pub</span> program_state<span class="token punctuation">:</span> <span class="token class-name">AccountInfo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token attribute attr-name">#[account(address = anchor_spl::token::ID)]</span>
    <span class="token keyword">pub</span> token_program<span class="token punctuation">:</span> <span class="token class-name">Program</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;info</span><span class="token punctuation">,</span> <span class="token class-name">Token</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[derive(Clone, AnchorSerialize, AnchorDeserialize)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">RequestResultParams</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> permission_bump<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> switchboard_state_bump<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">RequestResult</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;_</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">validate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> _ctx<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> _params<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">RequestResultParams</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">actuate</span><span class="token punctuation">(</span>ctx<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> params<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">RequestResultParams</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> client_state <span class="token operator">=</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> bump <span class="token operator">=</span> client_state<span class="token punctuation">.</span>bump<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> max_result <span class="token operator">=</span> client_state<span class="token punctuation">.</span>max_result<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">drop</span><span class="token punctuation">(</span>client_state<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> switchboard_program <span class="token operator">=</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>switchboard_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> vrf_request_randomness <span class="token operator">=</span> <span class="token class-name">VrfRequestRandomness</span> <span class="token punctuation">{</span>
            authority<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            vrf<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>vrf<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            oracle_queue<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>oracle_queue<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            queue_authority<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>queue_authority<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            data_buffer<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>data_buffer<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            permission<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            escrow<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>escrow<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            payer_wallet<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>payer_wallet<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            payer_authority<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>payer_authority<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            recent_blockhashes<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>recent_blockhashes<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            program_state<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>program_state<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            token_program<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>token_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> vrf_key <span class="token operator">=</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>vrf<span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> authority_key <span class="token operator">=</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>authority<span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;bump: {}&quot;</span><span class="token punctuation">,</span> bump<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;authority: {}&quot;</span><span class="token punctuation">,</span> authority_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;vrf: {}&quot;</span><span class="token punctuation">,</span> vrf_key<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> state_seeds<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">[</span>
            <span class="token operator">&amp;</span><span class="token constant">STATE_SEED</span><span class="token punctuation">,</span>
            vrf_key<span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            authority_key<span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token operator">&amp;</span><span class="token punctuation">[</span>bump<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;requesting randomness&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        vrf_request_randomness<span class="token punctuation">.</span><span class="token function">invoke_signed</span><span class="token punctuation">(</span>
            switchboard_program<span class="token punctuation">,</span>
            params<span class="token punctuation">.</span>switchboard_state_bump<span class="token punctuation">,</span>
            params<span class="token punctuation">.</span>permission_bump<span class="token punctuation">,</span>
            state_seeds<span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

        <span class="token macro property">emit!</span><span class="token punctuation">(</span><span class="token class-name">RequestingRandomness</span><span class="token punctuation">{</span>
            vrf_client<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            max_result<span class="token punctuation">:</span> max_result<span class="token punctuation">,</span>
            timestamp<span class="token punctuation">:</span> <span class="token namespace">clock<span class="token punctuation">::</span></span><span class="token class-name">Clock</span><span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unix_timestamp
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;randomness requested successfully&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> vrf_request_randomness <span class="token operator">=</span> <span class="token class-name">VrfRequestRandomness</span> <span class="token punctuation">{</span>
    authority<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    vrf<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>vrf<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    oracle_queue<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>oracle_queue<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    queue_authority<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>queue_authority<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    data_buffer<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>data_buffer<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    permission<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    escrow<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>escrow<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    payer_wallet<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>payer_wallet<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    payer_authority<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>payer_authority<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    recent_blockhashes<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>recent_blockhashes<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    program_state<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>program_state<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    token_program<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>token_program<span class="token punctuation">.</span><span class="token function">to_account_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> vrf_key <span class="token operator">=</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>vrf<span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> authority_key <span class="token operator">=</span> ctx<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>authority<span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;bump: {}&quot;</span><span class="token punctuation">,</span> bump<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;authority: {}&quot;</span><span class="token punctuation">,</span> authority_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;vrf: {}&quot;</span><span class="token punctuation">,</span> vrf_key<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> state_seeds<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">[</span>
    <span class="token operator">&amp;</span><span class="token constant">STATE_SEED</span><span class="token punctuation">,</span>
    vrf_key<span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    authority_key<span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">&amp;</span><span class="token punctuation">[</span>bump<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token macro property">msg!</span><span class="token punctuation">(</span><span class="token string">&quot;requesting randomness&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vrf_request_randomness<span class="token punctuation">.</span><span class="token function">invoke_signed</span><span class="token punctuation">(</span>
    switchboard_program<span class="token punctuation">,</span>
    params<span class="token punctuation">.</span>switchboard_state_bump<span class="token punctuation">,</span>
    params<span class="token punctuation">.</span>permission_bump<span class="token punctuation">,</span>
    state_seeds<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><!--]--></div></div><!--]--></div><h2 id="resources" tabindex="-1"><a class="header-anchor" href="#resources" aria-hidden="true">#</a> Resources</h2><h3 id="apis-and-libraries" tabindex="-1"><a class="header-anchor" href="#apis-and-libraries" aria-hidden="true">#</a> APIs and Libraries</h3><ul><li><a href="https://docs.switchboard.xyz/api/tasks" target="_blank" rel="noopener noreferrer">Switchboard Task Types<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://docs.rs/switchboard-v2/latest/switchboard_v2/" target="_blank" rel="noopener noreferrer">Rust API Docs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://docs.switchboard.xyz/api/ts" target="_blank" rel="noopener noreferrer">Typescript API Docs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://docs.switchboard.xyz/api/py" target="_blank" rel="noopener noreferrer">Python API Docs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://docs.switchboard.xyz/api/cli" target="_blank" rel="noopener noreferrer">CLI Docs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h3 id="examples" tabindex="-1"><a class="header-anchor" href="#examples" aria-hidden="true">#</a> Examples</h3><ul><li><a href="https://github.com/switchboard-xyz/switchboard-v2/tree/main/packages/feed-walkthrough" target="_blank" rel="noopener noreferrer">[Client] Custom Data Feed Walkthrough<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/switchboard-xyz/switchboard-v2/tree/main/programs/anchor-feed-parser" target="_blank" rel="noopener noreferrer">[Program] Anchor Feed Parser<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/switchboard-xyz/switchboard-v2/tree/main/programs/anchor-vrf-parser" target="_blank" rel="noopener noreferrer">[Program] Anchor VRF Parser<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h3 id="more-information" tabindex="-1"><a class="header-anchor" href="#more-information" aria-hidden="true">#</a> More Information</h3><ul><li><a href="https://docs.switchboard.xyz/introduction" target="_blank" rel="noopener noreferrer">Protocol Documentation<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://crawling-cent-d6b.notion.site/The-Switchboard-Deep-Dive-717df6ba0b92465e8118351466257a0f" target="_blank" rel="noopener noreferrer">SuperteamDAO Deep Dive<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/integrations/pyth.html" class="" aria-label="Pyth"><!--[--><!--]--> Pyth <!--[--><!--]--></a></span><span class="next"><a href="/integrations/mango.html" class="" aria-label="Mango Markets"><!--[--><!--]--> Mango Markets <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.28f6b3e6.js" defer></script>
  </body>
</html>
