<!DOCTYPE html>
<html lang="vi-VN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="title" content="Toàn tập Solana | Thử lại Transaction"><meta name="og:title" content="Toàn tập Solana | Thử lại Transaction"><meta name="description" content="Thi thoảng, một Transaction hợp lệ vẫn có thể bị hỏng trước khi được ghi nhận vào block. Để giải quyết vấn đề đó, lập trình viên phải phát triển các cơ chế lan truyền tuỳ chỉnh. Chi tiết về Thử lại Transaction và các khái niệm cơn bản khác trong Toàn tập Solana."><meta name="og:description" content="Thi thoảng, một Transaction hợp lệ vẫn có thể bị hỏng trước khi được ghi nhận vào block. Để giải quyết vấn đề đó, lập trình viên phải phát triển các cơ chế lan truyền tuỳ chỉnh. Chi tiết về Thử lại Transaction và các khái niệm cơn bản khác trong Toàn tập Solana."><meta name="og:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="og:image:alt" content="Solana splash card"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@solanacookbook"><meta name="twitter:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="robots" content="index,follow,noodp"><meta name="googlebot" content="index,follow"><link rel="icon" href="/solana_cookbook_lightmode.svg"><script data-domain="solanacookbook.com" src="https://plausible.io/js/plausible.js"></script><title>Thử lại Transaction | Toàn tập Solana</title>
    <link rel="modulepreload" href="/assets/app.28f6b3e6.js"><link rel="modulepreload" href="/assets/retrying-transactions.html.fcb1cee2.js"><link rel="modulepreload" href="/assets/retrying-transactions.html.6b416ced.js">
    <link rel="stylesheet" href="/assets/style.fecd2c41.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/vi/" class=""><!----><span class="site-name can-hide">Toàn tập Solana</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Đóng góp"><!--[--><!--]--> Đóng góp <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/vi/integrations" class="" aria-label="Tích hợp"><!--[--><!--]--> Tích hợp <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/guides/retrying-transactions.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/" class="" aria-label="中文"><!--[--><!--]--> 中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/guides/retrying-transactions.html" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/vi/guides/retrying-transactions.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/guides/retrying-transactions.html" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/guides/retrying-transactions.html" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Đóng góp"><!--[--><!--]--> Đóng góp <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/vi/integrations" class="" aria-label="Tích hợp"><!--[--><!--]--> Tích hợp <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/guides/retrying-transactions.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/" class="" aria-label="中文"><!--[--><!--]--> 中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/guides/retrying-transactions.html" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/vi/guides/retrying-transactions.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/guides/retrying-transactions.html" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/guides/retrying-transactions.html" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Mở đầu <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/vi/" class="sidebar-item" aria-label="Nhập môn Solana"><!--[--><!--]--> Nhập môn Solana <!--[--><!--]--></a><!----></li><li><a href="/vi/getting-started/installation.html" class="sidebar-item" aria-label="Cài đặt"><!--[--><!--]--> Cài đặt <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Khái niệm căn bản <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/vi/core-concepts/accounts.html" class="sidebar-item" aria-label="Accounts"><!--[--><!--]--> Accounts <!--[--><!--]--></a><!----></li><li><a href="/vi/core-concepts/programs.html" class="sidebar-item" aria-label="Programs"><!--[--><!--]--> Programs <!--[--><!--]--></a><!----></li><li><a href="/vi/core-concepts/transactions.html" class="sidebar-item" aria-label="Transactions"><!--[--><!--]--> Transactions <!--[--><!--]--></a><!----></li><li><a href="/vi/core-concepts/pdas.html" class="sidebar-item" aria-label="Program Derived Addresses (PDAs)"><!--[--><!--]--> Program Derived Addresses (PDAs) <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">Hướng dẫn <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/vi/guides/get-program-accounts.html" class="sidebar-item" aria-label="Đọc dữ liệu Program Account"><!--[--><!--]--> Đọc dữ liệu Program Account <!--[--><!--]--></a><!----></li><li><a href="/vi/guides/serialization.html" class="sidebar-item" aria-label="Tuần tự hoá dữ liệu"><!--[--><!--]--> Tuần tự hoá dữ liệu <!--[--><!--]--></a><!----></li><li><a href="/vi/guides/data-migration.html" class="sidebar-item" aria-label="Nâng cấp dữ liệu cho Program Account"><!--[--><!--]--> Nâng cấp dữ liệu cho Program Account <!--[--><!--]--></a><!----></li><li><a href="/vi/guides/account-maps.html" class="sidebar-item" aria-label="Account Maps"><!--[--><!--]--> Account Maps <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vi/guides/retrying-transactions.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Thử lại Transaction"><!--[--><!--]--> Thử lại Transaction <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vi/guides/retrying-transactions.html#co-the-ban-chua-biet" class="router-link-active router-link-exact-active sidebar-item" aria-label="Có thể bạn chưa biết"><!--[--><!--]--> Có thể bạn chưa biết <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vi/guides/retrying-transactions.html#hanh-trinh-cua-mot-transaction" class="router-link-active router-link-exact-active sidebar-item" aria-label="Hành trình của một Transaction"><!--[--><!--]--> Hành trình của một Transaction <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vi/guides/retrying-transactions.html#lam-the-nao-đe-nguoi-dung-gui-transactions" class="router-link-active router-link-exact-active sidebar-item" aria-label="Làm thế nào để người dùng gửi Transactions"><!--[--><!--]--> Làm thế nào để người dùng gửi Transactions <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vi/guides/retrying-transactions.html#lam-the-nao-đe-cac-not-rpc-lan-truyen-transaction" class="router-link-active router-link-exact-active sidebar-item" aria-label="Làm thế nào để các nốt RPC lan truyền Transaction"><!--[--><!--]--> Làm thế nào để các nốt RPC lan truyền Transaction <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/vi/guides/retrying-transactions.html#khi-nao-cac-transaction-bi-huy" class="router-link-active router-link-exact-active sidebar-item" aria-label="Khi nào các Transaction bị huỷ"><!--[--><!--]--> Khi nào các Transaction bị huỷ <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vi/guides/retrying-transactions.html#truoc-khi-transaction-đuoc-xu-ly" class="router-link-active router-link-exact-active sidebar-item" aria-label="Trước khi Transaction được xử lý"><!--[--><!--]--> Trước khi Transaction được xử lý <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vi/guides/retrying-transactions.html#sau-khi-transaction-đuoc-xu-ly-nhunh-truoc-khi-đuoc-ghi-vao-block" class="router-link-active router-link-exact-active sidebar-item" aria-label="Sau khi Transaction được xử lý nhưnh trước khi được ghi vào block"><!--[--><!--]--> Sau khi Transaction được xử lý nhưnh trước khi được ghi vào block <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/vi/guides/retrying-transactions.html#xu-tri-voi-transaction-bi-huy" class="router-link-active router-link-exact-active sidebar-item" aria-label="Xử trí với Transaction bị huỷ"><!--[--><!--]--> Xử trí với Transaction bị huỷ <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vi/guides/retrying-transactions.html#nghien-cuu-sendtransaction" class="router-link-active router-link-exact-active sidebar-item" aria-label="Nghiên cứu sendTransaction"><!--[--><!--]--> Nghiên cứu sendTransaction <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/vi/guides/retrying-transactions.html#tuy-chinh-thuat-toan-lan-truyen" class="router-link-active router-link-exact-active sidebar-item" aria-label="Tuỳ chỉnh thuật toán lan truyền"><!--[--><!--]--> Tuỳ chỉnh thuật toán lan truyền <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vi/guides/retrying-transactions.html#can-nhac-khi-bo-qua-preflight" class="router-link-active router-link-exact-active sidebar-item" aria-label="Cân nhắc khi bỏ qua Preflight"><!--[--><!--]--> Cân nhắc khi bỏ qua Preflight <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vi/guides/retrying-transactions.html#khi-nao-nen-tai-ky-transaction" class="router-link-active router-link-exact-active sidebar-item" aria-label="Khi nào nên tái ký transaction"><!--[--><!--]--> Khi nào nên tái ký transaction <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/vi/guides/retrying-transactions.html#loi-cam-on" class="router-link-active router-link-exact-active sidebar-item" aria-label="Lời cảm ơn"><!--[--><!--]--> Lời cảm ơn <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/vi/guides/debugging-solana-programs.html" class="sidebar-item" aria-label="Soát lỗi chương trình trên Solana"><!--[--><!--]--> Soát lỗi chương trình trên Solana <!--[--><!--]--></a><!----></li><li><a href="/vi/guides/feature-parity-testing.html" class="sidebar-item" aria-label="Đề xuất Kiểm thử Parity"><!--[--><!--]--> Đề xuất Kiểm thử Parity <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Tham khảo <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/vi/references/local-development.html" class="sidebar-item" aria-label="Lập trình ở Local"><!--[--><!--]--> Lập trình ở Local <!--[--><!--]--></a><!----></li><li><a href="/vi/references/keypairs-and-wallets.html" class="sidebar-item" aria-label="Cặp khoá và Ví"><!--[--><!--]--> Cặp khoá và Ví <!--[--><!--]--></a><!----></li><li><a href="/vi/references/basic-transactions.html" class="sidebar-item" aria-label="Gửi Transaction"><!--[--><!--]--> Gửi Transaction <!--[--><!--]--></a><!----></li><li><a href="/vi/references/accounts.html" class="sidebar-item" aria-label="Accounts"><!--[--><!--]--> Accounts <!--[--><!--]--></a><!----></li><li><a href="/vi/references/programs.html" class="sidebar-item" aria-label="Xây dựng Programs"><!--[--><!--]--> Xây dựng Programs <!--[--><!--]--></a><!----></li><li><a href="/vi/references/token.html" class="sidebar-item" aria-label="Tương tác với Tokens"><!--[--><!--]--> Tương tác với Tokens <!--[--><!--]--></a><!----></li><li><a href="/vi/references/staking.html" class="sidebar-item" aria-label="Staking"><!--[--><!--]--> Staking <!--[--><!--]--></a><!----></li><li><a href="/vi/references/nfts.html" class="sidebar-item" aria-label="NFTs"><!--[--><!--]--> NFTs <!--[--><!--]--></a><!----></li><li><a href="/vi/references/offline-transactions.html" class="sidebar-item" aria-label="Gửi Transactions Ngoại tuyến"><!--[--><!--]--> Gửi Transactions Ngoại tuyến <!--[--><!--]--></a><!----></li><li><a href="/vi/references/name-service.html" class="sidebar-item" aria-label="Dịch vụ tên miền"><!--[--><!--]--> Dịch vụ tên miền <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="thu-lai-transaction" tabindex="-1"><a class="header-anchor" href="#thu-lai-transaction" aria-hidden="true">#</a> Thử lại Transaction</h1><p>Trong một vài tính huống, một Transaction trông có vể hợp lệ có thể bị hết hạn ngay trước khi được chấp nhận (thêm vào block). Điều đó thường diễn ra nhất là khi mạng lưới bị nghẽn và một nốt RPC không thể truyền Transaction đến <a href="https://docs.solana.com/terminology#leader" target="_blank" rel="noopener noreferrer">leader<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. Dưới góc độ người dùng, bạn có thể nhận ra trường hợp này khi Transaction biến mất hoàn toàn. Trong khi các nốt RPC được trang bị một thuật toán lan truyền chung, ứng dụng của các lập trình viên vẫn có khả năng phát triển các luận lý lan truyền tuý chỉnh.</p><h2 id="co-the-ban-chua-biet" tabindex="-1"><a class="header-anchor" href="#co-the-ban-chua-biet" aria-hidden="true">#</a> Có thể bạn chưa biết</h2><div class="custom-container tip"><p class="custom-container-title">Những điều có thể bạn chưa biết</p><ul><li>Các nốt RPC sẽ thử lan truyền lại Transaction khi sử dụng một thuật toán chung</li><li>Ứng dụng riêng có thể hiện thực các luận lý lan truyền tuỳ chỉnh</li><li>Lập trình viên nên hiểu rõ tham số <code>maxRetries</code> của phương thức <code>sendTransaction</code> trong JSON-RPC.</li><li>Lập trình viên nên kích hoạt preflight để kiểm tra các tình huống lỗi trước khi gửi Transaction đi</li><li>Trước khi ký lại bất kỳ một Transaction nào, là <strong>rất quan trọng</strong> khi đảm bảo rằng blockhash của Transaction đã hết hạn</li></ul></div><h2 id="hanh-trinh-cua-mot-transaction" tabindex="-1"><a class="header-anchor" href="#hanh-trinh-cua-mot-transaction" aria-hidden="true">#</a> Hành trình của một Transaction</h2><h3 id="lam-the-nao-đe-nguoi-dung-gui-transactions" tabindex="-1"><a class="header-anchor" href="#lam-the-nao-đe-nguoi-dung-gui-transactions" aria-hidden="true">#</a> Làm thế nào để người dùng gửi Transactions</h3><p>Trong Solana, không tồn tại khái niệm mempool. Tất cả các Transaction, dù là được tạo nên từ các Program hay là từ người dùng, đều được điều hướng hiệu quả đến các leader để họ có thể xử lý và ghi nhận chúng vào block. Có 2 cách mà một Transaction có thể dược gửi đến các leader:</p><ol><li>Uỷ quyền cho các máy chủ RPC bằng phương thức <a href="https://docs.solana.com/developing/clients/jsonrpc-api#sendtransaction" target="_blank" rel="noopener noreferrer">sendTransaction<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> trong JSON-RPC.</li><li>Gửi trực tiếp đến các leader thông qua <a href="https://docs.rs/solana-client/1.7.3/solana_client/tpu_client/index.html" target="_blank" rel="noopener noreferrer">TPU Client<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ol><p>Phần lớn người dùng sẽ gửi Transaction thông qua máy chủ RPC. KHi một người dùng gửi Transaction đi, nốt RPC sẽ tiếp nhận và cố gắng truyền lần lượt các Transaction đến leader hiện tại cũng như leader tiếp theo. Cho đến khi Transaction được xử lý bởi một leader, sẽ không tồn tại bất kỳ bản sao nào của Transaction được lưu trữ ngoại trừ người dùng và các nốt RPC trung chuyển. Trong trường hợp TPU Client, quá trình lan truyền và điều hướng đến leader sẽ được xử lý toàn bộ bởi người dùng.</p><p><img src="/assets/tx-journey.dd6310be.png" alt="Transaction Journey"></p><h3 id="lam-the-nao-đe-cac-not-rpc-lan-truyen-transaction" tabindex="-1"><a class="header-anchor" href="#lam-the-nao-đe-cac-not-rpc-lan-truyen-transaction" aria-hidden="true">#</a> Làm thế nào để các nốt RPC lan truyền Transaction</h3><p>Ngay sau khi một nốt RPC tiếp nhận Transaction thông quá <code>sendTransaction</code>, nó sẽ chuyển Transaction đó thành một gói tin <a href="https://en.wikipedia.org/wiki/User_Datagram_Protocol" target="_blank" rel="noopener noreferrer">UDP<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> trước khi truyền đến các leader thích hợp. UDP cho phép validator có thể giao tiếp nhanh chóng với nhau, nhưng không đảm bảo gói tin có thể chắc chắn được chuyển đi đúng hướng.</p><p>Bởi vì lịch trình của các leader trong Solana là biết trước cho mỗi <a href="https://docs.solana.com/terminology#epoch" target="_blank" rel="noopener noreferrer">epoch<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (~2 ngày), một nốt RPC will lan truyền Transaction của nó trực tiếp đến leader hiện tại cũng như tiếp sau. Điều này trái ngược với các giao thức gossip khác, ví dụ như Ethereum truyền Transaction một cách ngẫu nhiên và phủ khắp trên toàn mạng. Mặc định, các nốt RPC sẽ thử chuyển Transaction đến các leader cứ mỗi 2 giây cho để khi, hoặc Transaction thành công, hoặc blockhash của Transaction bị quá hạn (150 blocks hoặc ~1 phút 19 giây tại thời điểm viết bài). Nếu hàng đợi các Transaction cần được truyền đi lớn hơn <a href="https://github.com/solana-labs/solana/blob/bfbbc53dac93b3a5c6be9b4b65f679fdb13e41d9/send-transaction-service/src/send_transaction_service.rs#L20" target="_blank" rel="noopener noreferrer">10,000 transactions<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, các Transaction đến sau sẽ bị từ chối. Để điều chỉnh cài đặt mặc định, tham khảo các tham số cho câu lệnh <a href="https://github.com/solana-labs/solana/blob/bfbbc53dac93b3a5c6be9b4b65f679fdb13e41d9/validator/src/main.rs#L1172" target="_blank" rel="noopener noreferrer">tại đây<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><p>Khi một nốt RPC lan truyền một Transaction, nó sẽ cố gắng chuyển Transaction đó để <a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/core/src/validator.rs#L867" target="_blank" rel="noopener noreferrer">Transaction Processing Unit (TPU)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> của một leader.</p><p>TPU xử lý các Transaction trong 5 pha riêng biệt:</p><ul><li><a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/core/src/fetch_stage.rs#L21" target="_blank" rel="noopener noreferrer">Fetch Stage<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/core/src/tpu.rs#L91" target="_blank" rel="noopener noreferrer">SigVerify Stage<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/core/src/banking_stage.rs#L249" target="_blank" rel="noopener noreferrer">Banking Stage<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/poh/src/poh_service.rs" target="_blank" rel="noopener noreferrer">Proof of History Service<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/core/src/tpu.rs#L136" target="_blank" rel="noopener noreferrer">Broadcast Stage<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p><img src="/assets/tpu-jito-labs.8bb32fb6.png" alt="TPU Overview"><small style="display:block;text-align:center;">Hình ảnh được cho phép bởi Jito Labs</small></p><p>Trong 5 pha này, Fetch Stage chịu trách nhiệm cho việc tiếp nhận Transaction. Trong phạm vi Fetch Stage, validator sẽ phân oại các Transaction mới đến dựa theo 3 cổng:</p><ul><li><a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/gossip/src/contact_info.rs#L27" target="_blank" rel="noopener noreferrer">tpu<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> xử lý các Transaction bình thường như là chuyển token, tạo NFT, và các chỉ thị cho các Program</li><li><a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/gossip/src/contact_info.rs#L31" target="_blank" rel="noopener noreferrer">tpu_vote<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> tập trung hoàn toàn vào Transaction bỏ phiếu</li><li><a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/gossip/src/contact_info.rs#L29" target="_blank" rel="noopener noreferrer">tpu_forwards<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> điều hướng các gói tin chưa xử lý đến các leader tiếp theo nếu leader hiện tại không đủ khả năng xử lý hết tất cả các Transaction</li></ul><p>Chi tiết hơn về TPU, vui lòng tham khảo <a href="https://jito-labs.medium.com/solana-validator-101-transaction-processing-90bcdc271143" target="_blank" rel="noopener noreferrer">bài viết rất xuất sắc của Jito Labs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><h2 id="khi-nao-cac-transaction-bi-huy" tabindex="-1"><a class="header-anchor" href="#khi-nao-cac-transaction-bi-huy" aria-hidden="true">#</a> Khi nào các Transaction bị huỷ</h2><p>Xuyên suốt hành trình của một Transaction, luôn có một vài tình huống Transaction đó có thể bị làm mất một cách tình cờ do mạng.</p><h3 id="truoc-khi-transaction-đuoc-xu-ly" tabindex="-1"><a class="header-anchor" href="#truoc-khi-transaction-đuoc-xu-ly" aria-hidden="true">#</a> Trước khi Transaction được xử lý</h3><p>Nếu mạng làm mất một Transaction, khả năng gần như nó sẽ bị huỹ trước khi được xử lý bởi một leader. <a href="https://en.wikipedia.org/wiki/Packet_loss" target="_blank" rel="noopener noreferrer">Mất gói tin<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> trong UDP là một nguyên nhân đơn giản nhất dẫn đến tình trạng trên. Trong thời gian mạng nghẽn, các validator có thể đã bị quá tải với số lượng khổng lồ các Transaction cần xử lý. Trong khi các validator được trang bị <code>tpu_forwards</code> để điều hướng các Transaction đến sau, thì vẫn luôn có một giới hạn số lượng các gói tin <a href="https://github.com/solana-labs/solana/blob/master/core/src/banking_stage.rs#L389" target="_blank" rel="noopener noreferrer">được điều hướng<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. Hơn nữa, mỗi lần điều hướng sẽ bị giới hạn trong phạm vị một đơn vị kết nối (hop) giữa các validator. Bởi vậy mà các Transaction được nhận thông qua cổng <code>tpu_forwards</code> sẽ không bao giờ được điều hướng thêm cho các validator khác.</p><p>Ngoài ra, cũng có 2 lý do được ghi nhận khác dẫn đến một Transaction bị đánh mất trước khi nó được xử lý. Trường hợp đầu tiên là những Transaction được gửi từ một RPC pool. Thi thoảng, một phần của RPC pool có thể đi nhanh hơn đáng kể phần còn lại của pool. Vấn đề này thường gặp khi các nốt trong pool cần làm việc kết hợp cùng nhau. Trong ví dụ này, <a href="https://docs.solana.com/developing/programming-model/transactions#recent-blockhash" target="_blank" rel="noopener noreferrer">recentBlockhash<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> của Transaction được truy vấn từ phần đi nhanh hơn của pool (Máy chủ A). Khi Transaction được gửi đến phần đi chậm của pool (Máy chủ B), các nốt này sẽ không nhận ra blockhash và sẽ vô hiệu hoá Transaction đó. Chúng ta có thể phát hiện lỗi này, nếu lập trình viên kích hoạt <a href="https://docs.solana.com/developing/clients/jsonrpc-api#sendtransaction" target="_blank" rel="noopener noreferrer">việc kiểm tra preflight<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> lúc gọi <code>sendTransaction</code>.</p><p><img src="/assets/dropped-via-rpc-pool.8d1ce9af.png" alt="Dropped via RPC Pool"></p><p>Một mạng bị rẽ nhánh tạm thời cũng có thể dẫn đến Transaction không hợp lệ. Nếu một validator bị chậm trong quá trình trung chuyển các block tại pha Banking Stage, rất có thể nó sẽ rẽ sang một nhánh thiểu số. Khi một Transaction được tạo, có khả năng Transaction tham chiếu đến <code>recentBlockhash</code> mà chỉ hợp lên trên nhánh thiểu số. Sau khi Transaction này được gửi đi, mạng lưới có thể nhảy về nhánh chính từ nhánh thiểu số trước khi Transaction được xử lý. Trong tình huống đó, Transaction sẽ không hợp lệ vì mạng không thể tìm thấy blockhash.</p><p><img src="/assets/dropped-minority-fork-pre-process.555653e1.png" alt="Dropped due to Minority Fork (Before Processed)"></p><h3 id="sau-khi-transaction-đuoc-xu-ly-nhunh-truoc-khi-đuoc-ghi-vao-block" tabindex="-1"><a class="header-anchor" href="#sau-khi-transaction-đuoc-xu-ly-nhunh-truoc-khi-đuoc-ghi-vao-block" aria-hidden="true">#</a> Sau khi Transaction được xử lý nhưnh trước khi được ghi vào block</h3><p>Trong trường hợp một Transaction tham chiếu <code>recentBlockhash</code> từ một nhánh thiểu số, nó vẫn có thể được xử lý bính thường. Tuy nhiên trong trường hợp đó, nó chỉ được tiếp nhận bởi leader trên nhánh thiểu số. Khi leader này cố gắng chia sẻ những Transaction mà nó đã xử lý với phần còn lại của mạng, lỗi đồng thuận sẽ xảy ra với phần cồng các validator khác đang duy trì trên nhánh chính và không hề nhận ra nhánh thiểu số. Lúc đó, Transaction sẽ bị xem là không hợp lên trước khi được đóng vào block.</p><p><img src="/assets/dropped-minority-fork-post-process.48c3c955.png" alt="Dropped due to Minority Fork (After Processed)"></p><h2 id="xu-tri-voi-transaction-bi-huy" tabindex="-1"><a class="header-anchor" href="#xu-tri-voi-transaction-bi-huy" aria-hidden="true">#</a> Xử trí với Transaction bị huỷ</h2><p>Trong khi các nốt RPC sẽ cố gắng lan truyền các Transaction, thuật toán được dùng thường chỉ đáp ứng các nhu cầu phổ biến và không tương thích với các nhu cầu đặt biệt. Để dự phòng trong tình huống mạng nghẽn, các lập trình viên sẽ phải tuỳ chỉnh thuật toán lan truyền trong ứng dụng của họ.</p><h3 id="nghien-cuu-sendtransaction" tabindex="-1"><a class="header-anchor" href="#nghien-cuu-sendtransaction" aria-hidden="true">#</a> Nghiên cứu sendTransaction</h3><p>Khi cần gửi Transaction, phương thức <code>sendTransaction</code> trong RPC là công cụ cơ bản nhất sẵn có cho lập trình viên. <code>sendTransaction</code> chỉ chịu trách nhiệm cho việc trung chuyển từ người dùng đến một nốt RPC. Nêys nốt đó nhận được Transaction, <code>sendTransaction</code> sẽ trả về id của Transaction và có thể dùng nó để theo dõi tiến độ của Transaction. Một phản hồi thành công từ RPC không đồng nghĩa với việc Transaction đó đã được tiếp nhận, xử lý và đóng vào một block trên mạng lưới Solana.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><h4 id="tham-so-cua-request" tabindex="-1"><a class="header-anchor" href="#tham-so-cua-request" aria-hidden="true">#</a> Tham số của Request</h4><ul><li><code>transaction</code>: <code>string</code> - Transaction đã được ký dầy đủ và được mã hoá lại thành chuỗi ký tự</li><li>(optional) <code>configuration object</code>: <code>object</code><ul><li><code>skipPreflight</code>: <code>boolean</code> - Nếu <code>true</code>, bỏ qua quá trình kiểm tra Transaction bằng preflight (Mặc định: <code>false</code>)</li><li>(optional) <code>preflightCommitment</code>: <code>string</code> - Cấp độ <a href="https://docs.solana.com/developing/clients/jsonrpc-api#configuring-state-commitment" target="_blank" rel="noopener noreferrer">Commitment<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> được dùng cho mô phỏng preflight trong ngân hàng chỗ trống (Mặc định: &quot;finalized&quot;).</li><li>(optional) <code>encoding</code>: <code>string</code> - Mã hoá được dùng cho dữ liệu trong Transaction. Hoặc &quot;base58&quot; (chậm), hoặc &quot;base64&quot;. (Mặc định: &quot;base58&quot;).</li><li>(optional) <code>maxRetries</code>: <code>usize</code> - Số lượng tối đa lần thử lại cho nốt RPC gửi Transaction đến các leader. Nếu tham số này không được đề cập, nốt RPC sẽ thử lại cho đến khi Transaction thành công hoặc blockhash bị hết hạn.</li></ul></li></ul><h4 id="response" tabindex="-1"><a class="header-anchor" href="#response" aria-hidden="true">#</a> Response</h4><ul><li><code>transaction id</code>: <code>string</code> - Chữ ký đầu tiên được nhúng vào trong Transaction. Id của transaction có thể dược dùng với <a href="https://docs.solana.com/developing/clients/jsonrpc-api#getsignaturestatuses" target="_blank" rel="noopener noreferrer">getSignatureStatuses<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> để cập nhật trạng thái mới nhất của Transaction.</li></ul></div><h2 id="tuy-chinh-thuat-toan-lan-truyen" tabindex="-1"><a class="header-anchor" href="#tuy-chinh-thuat-toan-lan-truyen" aria-hidden="true">#</a> Tuỳ chỉnh thuật toán lan truyền</h2><p>Để phát triển thuật toán lan truyền của riêng mình, lập trình viên cần hiểu rõ tham số <code>maxRetries</code> trong <code>sendTransaction</code>. Nếu được khai báo, <code>maxRetries</code> sẽ ghi đè lên giá trị mặc định của nốt RPC và cho phép lập trình viên điều khiển thử công quá trình thử lại trong <a href="https://github.com/solana-labs/solana/blob/98707baec2385a4f7114d2167ef6dfb1406f954f/validator/src/main.rs#L1258-L1274" target="_blank" rel="noopener noreferrer">phạm vi giới hạn hợp lý<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><p>Một cài đặt phổ biến cho việc thử lại thủ công là tạm lưu <code>lastValidBlockHeight</code> được truy vấn từ <a href="https://docs.solana.com/developing/clients/jsonrpc-api#getlatestblockhash" target="_blank" rel="noopener noreferrer">getLatestBlockhash<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. Sau khi lưu lại, một ứng dụng có thể <a href="https://docs.solana.com/developing/clients/jsonrpc-api#getblockheight" target="_blank" rel="noopener noreferrer">theo dõi blockheight của mạng lưới<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> và lan truyền Transaction thủ công thông qua thuật toán tuỳ chỉnh. Có một vài ứng dụng sử dụng giải thuật <a href="https://en.wikipedia.org/wiki/Exponential_backoff" target="_blank" rel="noopener noreferrer">exponential backoff<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, thì một vài ứng dụng khác ví như <a href="https://www.mango.markets/" target="_blank" rel="noopener noreferrer">Mango<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> chọn <a href="https://github.com/blockworks-foundation/mango-ui/blob/b6abfc6c13b71fc17ebbe766f50b8215fa1ec54f/src/utils/send.tsx#L713" target="_blank" rel="noopener noreferrer">liên tục tái gửi<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> Transaction với một khoảng thời gian lặp định trước cho đến khi quá hạn.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  Keypair<span class="token punctuation">,</span>
  Connection<span class="token punctuation">,</span>
  <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">,</span>
  SystemProgram<span class="token punctuation">,</span>
  Transaction<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> nacl <span class="token keyword">from</span> <span class="token string">&quot;tweetnacl&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ms<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> payer <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> toAccount <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">;</span>

  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:8899&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> airdropSignature <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">requestAirdrop</span><span class="token punctuation">(</span>
    payer<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    <span class="token constant">LAMPORTS_PER_SOL</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>airdropSignature<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> blockhashResponse <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getLatestBlockhashAndContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> lastValidBlockHeight <span class="token operator">=</span> blockhashResponse<span class="token punctuation">.</span>context<span class="token punctuation">.</span>slot <span class="token operator">+</span> <span class="token number">150</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> transaction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    feePayer<span class="token operator">:</span> payer<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    blockhash<span class="token operator">:</span> blockhashResponse<span class="token punctuation">.</span>value<span class="token punctuation">.</span>blockhash<span class="token punctuation">,</span>
    lastValidBlockHeight<span class="token operator">:</span> lastValidBlockHeight<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
    SystemProgram<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      fromPubkey<span class="token operator">:</span> payer<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      toPubkey<span class="token operator">:</span> toAccount<span class="token punctuation">,</span>
      lamports<span class="token operator">:</span> <span class="token number">1000000</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">serializeMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> signature <span class="token operator">=</span> nacl<span class="token punctuation">.</span>sign<span class="token punctuation">.</span><span class="token function">detached</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> payer<span class="token punctuation">.</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  transaction<span class="token punctuation">.</span><span class="token function">addSignature</span><span class="token punctuation">(</span>payer<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>signature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> rawTransaction <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> blockheight <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getBlockHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>blockheight <span class="token operator">&lt;</span> lastValidBlockHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    connection<span class="token punctuation">.</span><span class="token function">sendRawTransaction</span><span class="token punctuation">(</span>rawTransaction<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      skipPreflight<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    blockheight <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getBlockHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">while</span> <span class="token punctuation">(</span>blockheight <span class="token operator">&lt;</span> lastValidBlockHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  connection<span class="token punctuation">.</span><span class="token function">sendRawTransaction</span><span class="token punctuation">(</span>rawTransaction<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    skipPreflight<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  blockheight <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getBlockHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><!--]--></div></div><!--]--></div><p>Khi gọi <code>getLatestBlockhash</code>, ứng dụng nên chỉ rõ mức <a href="https://docs.solana.com/developing/clients/jsonrpc-api#configuring-state-commitment" target="_blank" rel="noopener noreferrer">commitment<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> mong muốn. Bằng cách đặt commitment là <code>confirmed</code> (đã được bỏ phiếu chọn) hoặc <code>finalized</code> (~30 block sau khi <code>confirmed</code>), ứng dụng có thể tránh được trường hợp đọc blockhash từ một nhánh rẽ thiểu số.</p><p>Nếu một ứng dụng truy cập vào những nốt RPC thông qua một máy chủ cân bằng tải, nó có lựa chọn các nốt cụ thể để chia nhỏ tải lượng. Các nốt RPC đáp ứng các yêu cầu thiên về dữ liệu như là <a href="/vi/guides/get-program-accounts.html" class="">getProgramAccounts</a> có thể dễ bị quá tải và bị đồng bộ chậm, cũng như là không thích hợp cho việc điều hướng Transaction. Với những ứng dụng đòi hỏi thời gian đáp ứng Transaction nhanh, nên có một máy chủ chuyên để xử lý duy nhất cho <code>sendTransaction</code>.</p><h3 id="can-nhac-khi-bo-qua-preflight" tabindex="-1"><a class="header-anchor" href="#can-nhac-khi-bo-qua-preflight" aria-hidden="true">#</a> Cân nhắc khi bỏ qua Preflight</h3><p>Mặc định, <code>sendTransaction</code> sẽ thực hiện preflight kiểm tra 3 bước trước khi gửi Transaction đó đi. Cụ thể, <code>sendTransaction</code> sẽ:</p><ul><li>Xác nhận tất cả các chữ ký là hợp lệ</li><li>Kiểm tra blockhash được tham chiếu có nằm trong phạm vi 150 block không</li><li>Chạy giải lập transaction trong ngân hàng chỗ trống được định nghĩa bởi <code>preflightCommitment</code>.</li></ul><p>Nếu một trong 3 bước trên bị lỗi, <code>sendTransaction</code> sẽ đẩy ra lỗi trước khi gửi transaction đi. Kiểm tra preflight sẽ không đảm bảo các trường hợp mất transaction hoặc là cho phép người dùng xử lý lỗi. Thay vào đó nó đảm bảo các lỗi cơ bản sẽ được kiểm tra trước và khuyến khích các lập trình viên nên giữ nó lại bằng cách gán <code>false</code> cho <code>skipPreflight</code>.</p><h3 id="khi-nao-nen-tai-ky-transaction" tabindex="-1"><a class="header-anchor" href="#khi-nao-nen-tai-ky-transaction" aria-hidden="true">#</a> Khi nào nên tái ký transaction</h3><p>Dù cho tất cả nỗ lực gửi lại, thì vẫn có một xác suất mà người dùng bị yêu cầu ký lại transaction đó. Trước khi tái ký bất kỳ một transaction nào, bạn cần <strong>đảm bảo rằng</strong> transaction trước đó đã hết hạn đối với blockhash. Nếu transaction vẫn còn hiệu lực, cả hai transaction có thể sẽ được xử lý bởi mạng lưới. Điều tương tự cũng có thể xảy ra trong trường hợp người dùng không may gửi 2 lần với 2 transaction giống nhau.</p><p>Trong Solana, một transaction được xem là đã vô hiệu hoá và an toàn khi giá trị blockhash được tham chiếu đã quá hạn so với <code>lastValidBlock</code> trả về từ hàm <code>getRecentBlockhash</code>. Lập trình viên có thể kiểm tra nhanh chóng giá trị blockhash thông qua hàm <a href="https://docs.solana.com/developing/clients/jsonrpc-api#isblockhashvalid" target="_blank" rel="noopener noreferrer">isBlockhashValid<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. Một khi blockhash đã quá hạn, người dùng có thể tái ký trên giá trị blockhash mới và hợp lệ.</p><h2 id="loi-cam-on" tabindex="-1"><a class="header-anchor" href="#loi-cam-on" aria-hidden="true">#</a> Lời cảm ơn</h2><p>Rất cảm ơn Trent Nelson, <a href="https://twitter.com/jacobvcreech" target="_blank" rel="noopener noreferrer">Jacob Creech<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, White Tiger, Le Yafo, <a href="https://twitter.com/buffalu__" target="_blank" rel="noopener noreferrer">Buffalu<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, và <a href="https://twitter.com/jito_labs" target="_blank" rel="noopener noreferrer">Jito Labs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> vì đã đọc và góp ý cho bài viết.</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/vi/guides/account-maps.html" class="" aria-label="Account Maps"><!--[--><!--]--> Account Maps <!--[--><!--]--></a></span><span class="next"><a href="/vi/guides/debugging-solana-programs.html" class="" aria-label="Soát lỗi chương trình trên Solana"><!--[--><!--]--> Soát lỗi chương trình trên Solana <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.28f6b3e6.js" defer></script>
  </body>
</html>
